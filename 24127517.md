# 1. Detailed Decomposition of the Metadata Extractor

The goal of this module is to receive a batch of raw image files and return a list of standardized Python/JSON objects (called `PhotoObject`), where each object contains the critical metadata for subsequent steps.

# 2. Define the `PhotoObject` Data Structure

This is the most crucial step to ensure subsequent modules can function.

- **To-do:** Create a `class` for `PhotoObject`.
    
- **Required Fields:**
    
    - `image_id`: A unique ID (e.g., `uuid` or temporary filename).
        
    - `original_filename`: The original filename uploaded by the user (e.g., `IMG_1234.jpg`).
        
    - `temp_file_path`: The path to the temporary image file on the server (so subsequent module can read and analyze it for blur).
        
    - `timestamp_utc`: A `datetime` object standardized to UTC (or `None` if missing).
        
    - `gps_coordinates`: A `dict` containing `{"lat": float, "lon": float}` (or `None` if missing).
        
    - `metadata_status`: A flag indicating the status (e.g., `"OK"`, `"MISSING_TIMESTAMP"`, `"MISSING_GPS"`, `"CORRUPT"`).
        

# 3. Build the Batch Processing Function

It receives the list of files from the API and coordinates the work.

- **To-do:** Write the function `def process_image_batch(uploaded_files):`
    
- **Internal Steps:**
    
    1. Initialize an empty list: `photo_objects_list = []`.
        
    2. Loop through each `file` in `uploaded_files`.
        
    3. Save the `file` to a temporary directory on the server and get its `temp_file_path`.
        
    4. Call the `extract_single_image_metadata(temp_file_path, file.filename)` function.
        
    5. `Append` the returned `PhotoObject` to the `photo_objects_list`.
        
    6. `Return photo_objects_list`.

# 4. Build the Single File Processor

This function handles the logic for each individual image file.

- **To-do:** Write the function `def extract_single_image_metadata(file_path, original_name):`
    
- **Internal Steps:**
    
    1. Initialize a default `PhotoObject` with its `image_id`, `original_filename`, and `temp_file_path`.
        
    2. Open the file using `exifread.process_file(f)`.
        
    3. Use a `try...except` block to catch errors (e.g., corrupt file, not an image). If an error occurs, set `metadata_status = "CORRUPT"` and `return photo_object`.
        
    4. Call the `parse_timestamp(exif_tags)` function (defined in 4.1). Assign the result to `photo_object.timestamp_utc`.
        
    5. Call the `parse_gps(exif_tags)` function (defined in 4.2). Assign the result to `photo_object.gps_coordinates`.
        
    6. Update `metadata_status` based on the results (e.g., if `timestamp_utc` is `None` and `gps_coordinates` is `None`, set status to `"MISSING_BOTH"`).
        
    7. `Return photo_object`.
        